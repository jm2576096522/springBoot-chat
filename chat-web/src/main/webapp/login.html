<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>登陆界面</title>

<!-- Set render engine for 360 browser -->
<meta name="renderer" content="webkit">

<!-- No Baidu Siteapp-->
<meta http-equiv="Cache-Control" content="no-siteapp" />

<link rel="icon" type="image/png" href="assets/i/favicon.png">

<!-- Add to homescreen for Chrome on Android -->
<meta name="mobile-web-app-capable" content="yes">
<link rel="icon" sizes="192x192" href="assets/i/app-icon72x72@2x.png">

<!-- Add to homescreen for Safari on iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Amaze UI" />
<link rel="apple-touch-icon-precomposed"
	href="assets/i/app-icon72x72@2x.png">

<!-- Tile icon for Win8 (144x144 + tile color) -->
<meta name="msapplication-TileImage"
	content="assets/i/app-icon72x72@2x.png">
<meta name="msapplication-TileColor" content="#0e90d2">

<!-- SEO: If your mobile URL is different from the desktop URL, add a canonical link to the desktop page https://developers.google.com/webmasters/smartphone-sites/feature-phones -->
<!-- <link rel="canonical" href="http://www.example.com/"> -->
<link rel="stylesheet" href="assets/css/amazeui.min.css">
<link rel="stylesheet" href="assets/css/app.css">
</head>
<body>
	<header>
		<div class="log-header">
			<h1>
				<a href="/">web chat</a>
			</h1>
		</div>
		<!-- 注册-->
		<div class="log-re">
			<button type="button"
				class="am-btn am-btn-default am-radius log-button"
				onClick="register()">注册</button>
		</div>
	</header>

	<div class="log">
		<div class="am-g">
			<div
				class="am-u-lg-3 am-u-md-6 am-u-sm-8 am-u-sm-centered log-content">
				<h1 class="log-title am-animation-slide-top">web chat</h1>

				<form class="am-form" id="log-form" onsubmit="return false">
					<!-- 问题反馈 -->
					<p>
						<label id="feedback">
							<!-- ${errorMsg} -->&nbsp;
						</label>
					</p>

					<!-- 邮箱 -->
					<div class="am-input-group am-radius am-animation-slide-left">
						<input type="email" id="doc-vld-email-2-1" name="uemail"
							class="am-radius" data-validation-message="请输入正确邮箱地址"
							placeholder="邮箱" required /> <span
							class="am-input-group-label log-icon am-radius"> <i
							class="am-icon-user am-icon-sm am-icon-fw"></i>
						</span>
					</div>
					<br>

					<!-- 密码-->
					<div
						class="am-input-group am-animation-slide-left log-animation-delay">
						<input type="password" name="upassword"
							class="am-form-field am-radius log-input" placeholder="密码"
							minlength="1" required> <span
							class="am-input-group-label log-icon am-radius"> <i
							class="am-icon-lock am-icon-sm am-icon-fw"></i>
						</span>
					</div>
					<br>
					<!-- 验证码-->
					<div
						class="am-input-group am-animation-slide-left log-animation-delay-c">
						<input type="text" id="yzm" name="yzm" class="yzm"
							style="float: left; width: 110px; margin-right: 10px;"
							data-validation-message="请输入验证码" placeholder="验证码" required /> <img
							id="yzm_img" class="yzm_img" src=""><a id="yzm_change">看不清，换一张</a>
					</div>
					<br>

					<!-- 登录按钮 -->
					<button type="submit"
						class="am-btn am-btn-primary am-btn-block am-btn-lg am-radius am-animation-slide-bottom log-animation-delay"
						onclick="login()">登录</button>
					连接地址:<input type="text" id="addr">
					发送消息:<input type="text" id="msg">
					<button></button>
				</form>
			</div>
		</div>
		<footer class="log-footer"> © 2014 AllMobilize, Inc. Licensed
			under MIT license. </footer>
	</div>

	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/amazeui.min.js"></script>
	<script src="assets/js/app.js"></script>

	<script type="text/javascript">
		<!-- 点击注册 -->
		function register() {
			window.location.href = 'register.html';
		}
		
		<!-- 点击登录 -->
		function login() {
			var uemail=$("input[name='uemail']").val();
			var upassword=$("input[name='upassword']").val();
			var yzm=$("input[name='yzm']").val();
			<!-- 邮箱非空 -->
			if(uemail==""){
				return false;
			}
			<!-- 密码非空 -->
			if(upassword==""){
				return false;
			}
			<!-- 验证码非空 -->
			if(yzm==""){
				return false;
			}
			addsocket();
			//window.location.href = 'index.html';
		}
		
		/*图片验证码  */
		/* $(function() {
			$("#yzm_img").attr("src", "chat-web/valicode?" + new Date().getTime());
		});
		$("#yzm_change").click(function() {
			$("#yzm_img").attr("src", "chat-web/valicode?" + new Date().getTime());
		}); */
		
		function   formatDate(now)   {    
            var   year=now.getFullYear();     
            var   month=now.getMonth()+1;     
            var   date=now.getDate();     
            var   hour=now.getHours();     
            var   minute=now.getMinutes();     
            var   second=now.getSeconds();     
            return   year+"-"+(month=month<10?("0"+month):month)+"-"+(date=date<10?("0"+date):date)+" "+(hour=hour<10?("0"+hour):hour)+":"+(minute=minute<10?("0"+minute):minute)+":"+(second=second<10?("0"+second):second);     
 } 
var output;
var websocket;
function init() {
  output = document.getElementById("output");
  testWebSocket();
}

function addsocket() {
	var wsaddr = 'ws://localhost:6879/sendMsgToApp/00:e0:4c:87:00:00*84:26:bd:20:1b:90';//$("#wsaddr").val();
	if (wsaddr=='') {
		alert("请填写websocket的地址");
		return false;
	}
	StartWebSocket(wsaddr);
}

function closesocket() {
	websocket.close();
}

function StartWebSocket(wsUri) {
  websocket = new WebSocket(wsUri);
  websocket.onopen = function(evt) { onOpen(evt) };
  websocket.onclose = function(evt) { onClose(evt) };
  websocket.onmessage = function(evt) { onMessage(evt) };
  websocket.onerror = function(evt) { onError(evt) }; }
	
  function onOpen(evt) { 
	   writeToScreen("<span style='color:red'>连接成功，现在你可以发送信息啦！！！</span>");
	}
  function onClose(evt) {
      writeToScreen("<span style='color:red'>websocket连接已断开!!!</span>");
		websocket.close();
	}
  function onMessage(evt) {
	   writeToScreen('<span style="color:blue">服务端回应&nbsp;'+formatDate(new Date())+'</span><br/><span class="bubble">'+ evt.data+'</span>');	
	}
  function onError(evt) {
      writeToScreen('<span style="color: red;">发生错误:</span> '+ evt.data);
	}
  function doSend() {
	    var message=$("#message").val();
		if (message=='') {
			alert("请先填写发送信息");
			$("#message").focus();
			return false;
		}
		if (typeof websocket==="undefined"){
			alert("websocket还没有连接，或者连接失败，请检测");
			return false;
		}
		if (websocket.readyState==3) {
			alert("websocket已经关闭，请重新连接");
			return false;
		}
		console.log(websocket);
		$("#message").val('');
		writeToScreen('<span style="color:green">你发送的信息&nbsp;'+formatDate(new Date())+'</span><br/>'+ message);
      websocket.send(message);
		}

  function writeToScreen(message) {
    
     
      alert(message);
		/* var div = "<div class='newmessage'>"+message+"</div>";
		var d = $("#output");
		var d=d[0];
      var doScroll = d.scrollTop == d.scrollHeight - d.clientHeight;
		$("#output").append(div);
      if (doScroll) {
          d.scrollTop = d.scrollHeight - d.clientHeight;
      } */
		}

 
  function en(event){
		var evt=evt?evt:(window.event?window.event:null);
      if (evt.keyCode==13){
       doSend()
      }
	}
	

  
	</script>
</body>
</html>